# –ö–ü–û –î–ó4 –ê–Ω—Ç–∏–ø–ª–∞–≥–∏–∞—Ç

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:

- Payments Service: –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞, –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞.
- Orders Service: –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞, –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ RabbitMQ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ –æ–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞. –ü—Ä–æ–µ–∫—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (at-least-once) –∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É effectively exactly once –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ö–æ–ø–æ–Ω–µ–Ω—Ç—ã:

- API Gateway (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ): –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º.
- Payments Service:
  - –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞.
  - –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞.
  - –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞.
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–æ–≤.
- Orders Service:
  - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞.
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤.
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ RabbitMQ.

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:

- ASP.NET Core: –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.
- Entity Framework Core: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
- RabbitMQ: –î–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.
- Docker: –î–ª—è –∑–∞–ø—É—Å–∫–∞ RabbitMQ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.

## API

Payments Service

1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—á–µ—Ç–∞
- POST /api/payments/create-account
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: userId (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ).
  - –û—Ç–≤–µ—Ç: Account created. –∏–ª–∏ –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ —Å—á–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
2. –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á–µ—Ç–∞
- POST /api/payments/add-funds
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: userId (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ), amount (–¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ).
  - –û—Ç–≤–µ—Ç: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤–æ–º –±–∞–ª–∞–Ω—Å–µ.
3. –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞
- GET /api/payments/balance
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: userId (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ).
  - –û—Ç–≤–µ—Ç: –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
 
Orders Service

1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- POST /api/orders/create-order
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: userId (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ), totalAmount (–¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ).
  - –û—Ç–≤–µ—Ç: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞.
2. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- GET /api/orders/list-orders
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: userId (—Ü–µ–ª–æ–µ —á–∏—Å–ª–æ).
  - –û—Ç–≤–µ—Ç: –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
- GET /api/orders/order-status
  - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: orderId (—Å—Ç—Ä–æ–∫–∞).
  - –û—Ç–≤–µ—Ç: –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (Created, Paid, Failed).

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏)

–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ Orders Service.
- Orders Service —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –æ –∑–∞–∫–∞–∑–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ OrderCreated –≤ RabbitMQ.
- Payments Service –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ OrderCreated –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω:
  - –°—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å–æ —Å—á–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  - –ü—É–±–ª–∏–∫—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ PaymentCompleted –≤ RabbitMQ.
- Orders Service –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ PaymentCompleted –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ Paid.

–ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

- At-least-once delivery: RabbitMQ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑.
- Effectively exactly once: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, OrderId) –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π.

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- .NET SDK: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ .NET SDK –≤–µ—Ä—Å–∏–∏ 6 –∏–ª–∏ –≤—ã—à–µ.
- Docker: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –¥–ª—è –∑–∞–ø—É—Å–∫–∞ RabbitMQ.

2. –ó–∞–ø—É—Å–∫ RabbitMQ
–ó–∞–ø—É—Å—Ç–∏—Ç–µ RabbitMQ —á–µ—Ä–µ–∑ Docker:

```
bash

docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:management
```

3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö SQL Server (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ LocalDB –∏–ª–∏ Docker).
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ appsettings.json –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

```
json

"ConnectionStrings": {
  "DefaultConnection": "Server=YourServerName;Database=YourDatabaseName;Trusted_Connection=True;"
}
```

4. –ó–∞–ø—É—Å–∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –≤ Visual Studio.
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç PaymentsService –∏ OrdersService.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, http://localhost:5000 –∏ http://localhost:5001).

5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Postman –∏–ª–∏ Swagger –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API:

- Payments Service: http://localhost:5000/swagger
- Orders Service: http://localhost:5001/swagger

–ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è:

- –°–æ–∑–¥–∞–π—Ç–µ —Å—á–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (POST /api/payments/create-account).
- –ü–æ–ø–æ–ª–Ω–∏—Ç–µ —Å—á–µ—Ç (POST /api/payments/add-funds).
- –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–∞–∑ (POST /api/orders/create-order).
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (GET /api/orders/order-status).

## –í–ê–ñ–ù–û
–ü—Ä–æ–µ–∫—Ç –≤–æ–∑–º–æ–Ω–æ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ VisualStudio –Ω–∏–∂–µ 26 –≥–æ–¥–∞ (–Ω–æ —ç—Ç–æ –Ω–µ —Ç–æ—á–Ω–æ (–º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å—Å—è))
–£ –º–µ–Ω—è –≤—Å—ë –ø–æ—à–ª–æ –ø–æ –∂–æ–ø–µ, –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É–º–æ–ª—è—é –ø–æ—Å—Ç–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –¥–≤–æ–µ—á–∫—É —á—Ç–æ–±—ã –Ω–∞–∫–æ–ø 3,5 —Å—Ç–∞–ª üò≠üôè
